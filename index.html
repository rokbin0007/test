<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>우주에서 떨어지는 운석 피하기 게임</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom, #001122, #003366);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Courier New', monospace;
            color: white;
            overflow: hidden;
        }
        
        #gameContainer {
            text-align: center;
            position: relative;
        }
        
        #gameCanvas {
            border: 2px solid #00ffff;
            background: linear-gradient(to bottom, #000033, #001155);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }
        
        #gameInfo {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 18px;
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }
        
        #instructions {
            margin-top: 20px;
            font-size: 14px;
            color: #cccccc;
        }
        
        .star {
            position: absolute;
            background: white;
            width: 1px;
            height: 1px;
            animation: twinkle 2s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <div id="gameInfo">시간: <span id="timer">0</span>초</div>
        <div id="instructions">
            PC: 화살표 키로 이동, 스페이스바로 시작/재시작<br>
            모바일: 화면 터치로 이동 및 재시작
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const timerElement = document.getElementById('timer');
        
        // 게임 상태
        let gameState = 'waiting'; // 'waiting', 'playing', 'gameOver'
        let startTime = 0;
        let survivalTime = 0;
        
        // UFO 객체
        const ufo = {
            x: canvas.width / 2,
            y: canvas.height - 80,
            width: 40,
            height: 20,
            speed: 5
        };
        
        // 운석 배열
        let meteors = [];
        
        // 별 배경
        const stars = [];
        
        // UFO 도트맵 (반원형 UFO)
        const ufoPixels = [
            [0,0,0,1,1,1,1,1,1,0,0,0],
            [0,1,1,2,2,2,2,2,2,1,1,0],
            [1,2,2,3,3,3,3,3,3,2,2,1],
            [1,3,3,4,4,4,4,4,4,3,3,1],
            [2,4,4,5,5,5,5,5,5,4,4,2]
        ];
        
        // UFO 색상 팔레트
        const ufoColors = [
            'transparent',
            '#333333',
            '#666666',
            '#999999',
            '#cccccc',
            '#ffffff'
        ];
        
        // 초기화
        function init() {
            createStars();
            gameLoop();
        }
        
        // 별 생성
        function createStars() {
            for (let i = 0; i < 100; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    opacity: Math.random()
                });
            }
        }
        
        // UFO 그리기
        function drawUFO() {
            const pixelSize = 3;
            const startX = ufo.x - (ufoPixels[0].length * pixelSize) / 2;
            const startY = ufo.y - (ufoPixels.length * pixelSize) / 2;
            
            for (let row = 0; row < ufoPixels.length; row++) {
                for (let col = 0; col < ufoPixels[row].length; col++) {
                    const colorIndex = ufoPixels[row][col];
                    if (colorIndex > 0) {
                        ctx.fillStyle = ufoColors[colorIndex];
                        ctx.fillRect(
                            startX + col * pixelSize,
                            startY + row * pixelSize,
                            pixelSize,
                            pixelSize
                        );
                    }
                }
            }
            
            // UFO 글로우 효과
            ctx.shadowColor = '#00ffff';
            ctx.shadowBlur = 10;
            ctx.strokeStyle = '#00ffff';
            ctx.lineWidth = 1;
            ctx.strokeRect(startX - 2, startY - 2, ufoPixels[0].length * pixelSize + 4, ufoPixels.length * pixelSize + 4);
            ctx.shadowBlur = 0;
        }
        
        // 운석 생성
        function createMeteor() {
            meteors.push({
                x: Math.random() * (canvas.width - 20),
                y: -20,
                width: 20,
                height: 20,
                speed: 2 + Math.random() * 3
            });
        }
        
        // 운석 그리기
        function drawMeteors() {
            meteors.forEach(meteor => {
                // 운석 그라디언트
                const gradient = ctx.createRadialGradient(
                    meteor.x + meteor.width/2, meteor.y + meteor.height/2, 0,
                    meteor.x + meteor.width/2, meteor.y + meteor.height/2, meteor.width/2
                );
                gradient.addColorStop(0, '#ff6600');
                gradient.addColorStop(0.5, '#ff3300');
                gradient.addColorStop(1, '#990000');
                
                ctx.fillStyle = gradient;
                ctx.fillRect(meteor.x, meteor.y, meteor.width, meteor.height);
                
                // 운석 테두리
                ctx.strokeStyle = '#ffff00';
                ctx.lineWidth = 1;
                ctx.strokeRect(meteor.x, meteor.y, meteor.width, meteor.height);
                
                // 불꽃 효과
                ctx.shadowColor = '#ff3300';
                ctx.shadowBlur = 5;
                ctx.fillStyle = '#ff9900';
                ctx.fillRect(meteor.x + 2, meteor.y + 2, meteor.width - 4, meteor.height - 4);
                ctx.shadowBlur = 0;
            });
        }
        
        // 별 그리기
        function drawStars() {
            ctx.fillStyle = 'white';
            stars.forEach(star => {
                ctx.globalAlpha = star.opacity;
                ctx.fillRect(star.x, star.y, 1, 1);
                star.opacity += (Math.random() - 0.5) * 0.02;
                star.opacity = Math.max(0.1, Math.min(1, star.opacity));
            });
            ctx.globalAlpha = 1;
        }
        
        // 충돌 감지
        function checkCollision() {
            const ufoLeft = ufo.x - 18;
            const ufoRight = ufo.x + 18;
            const ufoTop = ufo.y - 8;
            const ufoBottom = ufo.y + 8;
            
            return meteors.some(meteor => {
                return meteor.x < ufoRight &&
                       meteor.x + meteor.width > ufoLeft &&
                       meteor.y < ufoBottom &&
                       meteor.y + meteor.height > ufoTop;
            });
        }
        
        // 게임 업데이트
        function update() {
            if (gameState === 'playing') {
                // 생존 시간 업데이트
                survivalTime = ((Date.now() - startTime) / 1000).toFixed(1);
                timerElement.textContent = survivalTime;
                
                // 운석 생성 (난이도 증가)
                if (Math.random() < 0.02 + survivalTime * 0.001) {
                    createMeteor();
                }
                
                // 운석 이동
                meteors.forEach((meteor, index) => {
                    meteor.y += meteor.speed;
                    if (meteor.y > canvas.height) {
                        meteors.splice(index, 1);
                    }
                });
                
                // 충돌 감지
                if (checkCollision()) {
                    gameState = 'gameOver';
                }
            }
        }
        
        // 화면 그리기
        function draw() {
            // 배경 클리어
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 별 그리기
            drawStars();
            
            if (gameState === 'waiting') {
                ctx.fillStyle = '#00ffff';
                ctx.font = '32px Courier New';
                ctx.textAlign = 'center';
                ctx.fillText('UFO 피하기 게임', canvas.width/2, canvas.height/2 - 50);
                
                ctx.fillStyle = '#ffffff';
                ctx.font = '18px Courier New';
                ctx.fillText('스페이스바를 눌러 시작하세요', canvas.width/2, canvas.height/2);
                ctx.fillText('(모바일: 화면 터치)', canvas.width/2, canvas.height/2 + 30);
                
            } else if (gameState === 'playing') {
                drawUFO();
                drawMeteors();
                
            } else if (gameState === 'gameOver') {
                drawUFO();
                drawMeteors();
                
                // 게임 오버 오버레이
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#ff3300';
                ctx.font = '48px Courier New';
                ctx.textAlign = 'center';
                ctx.fillText('GAME OVER', canvas.width/2, canvas.height/2 - 50);
                
                ctx.fillStyle = '#ffffff';
                ctx.font = '24px Courier New';
                ctx.fillText(`생존 시간: ${survivalTime}초`, canvas.width/2, canvas.height/2);
                
                ctx.font = '18px Courier New';
                ctx.fillText('스페이스바를 눌러 재시작', canvas.width/2, canvas.height/2 + 50);
                ctx.fillText('(모바일: 화면 터치)', canvas.width/2, canvas.height/2 + 80);
            }
        }
        
        // 게임 시작
        function startGame() {
            gameState = 'playing';
            startTime = Date.now();
            survivalTime = 0;
            meteors = [];
            ufo.x = canvas.width / 2;
        }
        
        // 게임 루프
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        // 키보드 이벤트
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                if (gameState === 'waiting' || gameState === 'gameOver') {
                    startGame();
                }
            }
            
            if (gameState === 'playing') {
                if (e.code === 'ArrowLeft' && ufo.x > 20) {
                    ufo.x -= ufo.speed;
                }
                if (e.code === 'ArrowRight' && ufo.x < canvas.width - 20) {
                    ufo.x += ufo.speed;
                }
            }
        });
        
        // 터치 및 마우스 이벤트
        let touchStartX = 0;
        
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (gameState === 'waiting' || gameState === 'gameOver') {
                startGame();
                return;
            }
            
            touchStartX = e.touches[0].clientX;
        });
        
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (gameState === 'playing') {
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                const canvasX = (touch.clientX - rect.left) * (canvas.width / rect.width);
                
                if (canvasX >= 20 && canvasX <= canvas.width - 20) {
                    ufo.x = canvasX;
                }
            }
        });
        
        canvas.addEventListener('click', (e) => {
            if (gameState === 'waiting' || gameState === 'gameOver') {
                startGame();
                return;
            }
            
            if (gameState === 'playing') {
                const rect = canvas.getBoundingClientRect();
                const clickX = (e.clientX - rect.left) * (canvas.width / rect.width);
                
                if (clickX < canvas.width / 2 && ufo.x > 20) {
                    ufo.x -= ufo.speed * 3;
                } else if (clickX > canvas.width / 2 && ufo.x < canvas.width - 20) {
                    ufo.x += ufo.speed * 3;
                }
            }
        });
        
        // 연속 키 입력 처리
        const keys = {};
        
        document.addEventListener('keydown', (e) => {
            keys[e.code] = true;
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });
        
        // 연속 이동 처리
        function handleContinuousInput() {
            if (gameState === 'playing') {
                if (keys['ArrowLeft'] && ufo.x > 20) {
                    ufo.x -= ufo.speed;
                }
                if (keys['ArrowRight'] && ufo.x < canvas.width - 20) {
                    ufo.x += ufo.speed;
                }
            }
            requestAnimationFrame(handleContinuousInput);
        }
        
        // 게임 시작
        init();
        handleContinuousInput();
    </script>
</body>
</html>
